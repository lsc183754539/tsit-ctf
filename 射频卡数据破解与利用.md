---
title: 射频卡数据破解与利用
date: 2020-01-03 09:33:34
tags: [射频卡,破解,复制,数据篡改,复现,M1卡,UID]
categories: [笔记 ]
---

# 关于射频卡

## 什么是射频卡?
> 射频识别（RFID）是 Radio Frequency Identification 的缩写。
其原理为阅读器与标签之间进行非接触式的数据通信，达到识别目标的目的。RFID 的应用非常广泛，典型应用有动物晶片、汽车晶片防盗器、门禁管制、停车场管制、生产线自动化、物料管理。  
——参考百度百科“[射频识别技术](https://baike.baidu.com/item/%E5%B0%84%E9%A2%91%E8%AF%86%E5%88%AB%E6%8A%80%E6%9C%AF/9524139)”词条。  
<!--more-->
利用RFID技术生产的卡片一般称为射频卡。

## 卡片分类及可利用卡片分类
* UID卡：除0扇区不可写，其他扇区均可重复擦写，0扇区的数据为预设好，无法重写
* CUID卡：所有扇区均可重复擦写
* FUID卡：0扇区只能写入一次，写入后不可更改

## 关于M1卡片
* M1卡片是目前几种比较常见的几种卡片之一，多用于电梯门禁卡，园区消费卡等场景，包括部分公交卡亦是如此。
* M1卡片本身存在一些漏洞，使得可以通过一些特殊手段进行密钥的破解，从而得到扇区和块的十六进制数据。

## M1卡片存储逻辑结构
此处以13.56MHZ的MIFAREClassic的1K卡为例介绍：
![扇区示意图](https://i.jpg.dog/img/5d1d67db7d9621feaae05e5c2ffd9a3d.jpg)  

* 该卡片共16个扇区，分别为扇区0到扇区15
* 每个扇区分为4个块（即图中的每一行）
* 扇区0为卡片信息扇区，0扇区0块的前8位为卡片的UID（即卡片的编码，该编码全球唯一），0块的其他位为卡片的厂商信息，一般不需要改动（有时候改动会引起非加密卡被读作加密卡的错误）
* 每个扇区的0块的前12位(16进制)及后12位为该扇区的密钥A及密钥B
* 0扇区的密钥A/B必定为全F（非加密）
* 1-15扇区的0、1、2块为数据存储的块，3块为密钥块，可能存在密钥A/B
* 其他详见图示中的颜色指示

# 数据破解与利用
## 准备阶段
* 读写卡硬件及软件(约RMB30)
	* PN532模块一个
	* USB转TTL模块一套
	* 连接线
	* ![图片来自酷安@七岁超可爱](https://i.jpg.dog/img/2d836f072c48ac6de77535fcb9b702e8.png)
	* ![0a46a98a948821af25c84ad1b931a45f.png](https://i.jpg.dog/img/0a46a98a948821af25c84ad1b931a45f.png)
	* 或者再有钱可以上功能强大的变色龙等
* 软件（驱动程序、上位机、十六进制编辑器，手机NFC读写工具、MifareClassicTool.apk等）[下载地址](https://www.lanzous.com/i6lyvjg)

## 原卡数据破解过程
* 连接pn532和电脑，并按提示（读驱动文件夹中的说明）正确安装驱动
* 打开上位机，连接pn532
* 将卡片放在pn532上，点击读取数据，等待读取破解完成
* 读取完成后点数据列表的左上方的箭头，对数据进行保存（.dump格式）

## 数据含义破解 
* 读取到数据后可用winhex等软件对保存的16进制文件进行数据分析
* 多次消费并读取数据，对比变更的数据，即金额信息
* 破解编码规律（自行探索）
* 根据得到的各种信息及需求伪造数据
* 数据使用上位机的写IC卡功能写入空白卡（推荐使用CUID空白卡）

# 某鲁软件园附近某大厦电梯卡破解
* 前期参考上面步骤
* 每张电梯卡能到达的楼层不同，数据存在区别
* 改电梯卡每次读取时会尝试写入0扇区为空（反复制卡片），所以采用FUID卡片进行卡片复制，解决重写验证。
  

# 声明：
* 本文章仅供技术交流，请勿用于违法犯罪行为
* 对阅读本文导致的违法犯罪行为，请违法人员自行承担相关责任，所有后果及责任与本文作者无关
* 请勿未授权转载