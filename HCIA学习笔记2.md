---
title: HCIA学习笔记(2/5)
date: 2019-12-30 11:35:03
tags: [笔记,HCIA,网络,华为,网工]
categories: [笔记 ]
---

# HCIA学习笔记（2/7）
## IP编址
### 网络层提供了IP路由功能。
* IP报文结构
* 公有IP，私有IP，特殊IP范围
* 掌握VLSM技术
* 理解网关的作用  
<!--more-->
### 上层协议类型  
![上层协议类型](https://i.jpg.dog/img/2d04c7120555a6c4724aca9488f45325.png)

### IP地址头最大不超过60字节，一般固定产长度20字节  
![74b7036b03bda780763484ab273e8f41.png](https://i.jpg.dog/img/74b7036b03bda780763484ab273e8f41.png)
  
### 网关是用来转发来自不同网段之间的数据包。

## IP地址的分段:  
![91f90c7756ba5a973a0cff1684fafc73.png](https://i.jpg.dog/img/91f90c7756ba5a973a0cff1684fafc73.png)

### 广播地址：广播地址为255.255.255.255，仅主机位为255时为定向广播地址。路由器隔离广播域，但可用定向广播方式广播。

### VLSM（可变长子网掩码）：
为了有效的使用无类别域间路由（CIDR）和路由汇聚(route summary)来控制路由表的大小

## Ethernet Ⅱ 帧格式：
![ffdabbdaad5ba9c532550fd33d912de9.png](https://i.jpg.dog/img/ffdabbdaad5ba9c532550fd33d912de9.png)
### 数据帧传输：
数据链路层之间通信是基于MAC地址(16进制)的  
![bb4d32ec290574688cb98506eebbe1a2.png](https://i.jpg.dog/img/bb4d32ec290574688cb98506eebbe1a2.png)
## ping指令及arp协议ICMP协议：
> ping指令通过ICMP协议发送和接收数据包，必须要有目标的MAC地址，默认源主机的arp缓存表内无目标主机的MAC地址，通过arp协议广播寻找IP地址对应的主机的MAC地址，目标主机接收到请求后保存源主机的MAC地址，并通过arp协议单播回复源主机自己的MAC地址，源主机接收到目的主机的MAC地址后，将目的主机的MAC地址保存到自己的arp缓存表中，并构造ICMP协议数据包，发送至目标主机，目标主机接收到ICMP包后，通过ICMP协议及ARP缓存表中的源主机的MAC地址，构造ICMP响应数据包，并发送给源主机，源主机解包后给予用户反馈，并循环5次测试(默认，可修改次数)。
### 交换机的工作原理：
* 学习：建立MAC地址表（学习ARP中的源MAC地址与交换机端口的映射）
* 转发：交换机的一个端口接收到数据帧，向另一端口发送出去
* 泛洪：交换机的一个端口接收到数据帧，向其他所有端口发送出去（也称广播）
### 交换机MAC地址表的学习方式构建过程：
> 通过主机1向网内广播的arp请求包中的源MAC及端口的对应关系学习后保存，再通过泛洪方式向其他端口发送出去，对应IP的主机2会向主机1做单播ARP包的发送，期间经过交换机时，交换机通过学习方式将主机2的MAC地址及对应的端口保存到MAC地址表，并将数据包根据MAC地址表转发给主机1，主机1根据接收到的ARP相应包建立ARP缓存表。

### ping命令的执行过程数据分析：
![e40add0947bce3c5da4d5ad0dade2e88.png](https://i.jpg.dog/img/e40add0947bce3c5da4d5ad0dade2e88.png) 

#### ping 192.168.1.5命令构建的ICMP请求包：
* 网络层：源IP:192.168.1.4	目的IP:192.168.1.5 协议号:1（ICMP)  
* 数据链路层：源MAC:00-04	目的MAC:未知  type:0x0800(ip)
> 从上述得知1.5的MAC地址未知，所以构造1.5的arp请求并进行广播，以此构建关于192.168.1.5的mac地址表
#### ARP Request 请求包 广播发
* 请求数据：源IP:192.168.1.4 源MAC地址	目的IP:192.168.1.5	目的MAC地址ff-ff（泛洪广播）
* 数据链路层：源MAC:00-04	目的MAC:ff-ff(广播)	type:0x0806（arp）
#### ARP Replay 响应包 单播发
* 响应数据：源IP：192.168.1.5 源MAC地址	目的IP：192.168.1.4 目的MAC地址
* 数据链路层：源MAC地址:00-05	目的MAC：00-04	type:0x0806（arp）
#### ICMP 请求包构建：
* 网络层：源IP：192.168.1.4	目的IP：192.168.1.5 协议号：1（ICMP）
* 数据链路层：源MAC:00-04	目的MAC:00-05	type:0x0800(ip)
#### ICMP 响应包构建：
* 网络层：源IP:192.168.1.5	目的IP:192.168.1.4 协议号:1（ICMP）
* 数据链路层：源MAC:00-05	目的MAC:00-04 type:0x0800(ip)
##MAC地址表300秒自动老化清除